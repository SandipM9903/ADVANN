âœ… Day Next: Role Based Authorization + Add Role inside JWT Token
âœ… Step 1: Add Role in JWT Token (JwtService)

Update your generateToken() method like this:

public String generateToken(UserDetails userDetails) {

        Map<String, Object> claims = new HashMap<>();

        claims.put("role", userDetails.getAuthorities().toString());

        return Jwts.builder()
                .setClaims(claims)
                .setSubject(userDetails.getUsername())
                .setIssuedAt(new Date(System.currentTimeMillis()))
                .setExpiration(new Date(System.currentTimeMillis() + jwtExpiration))
                .signWith(getSignInKey(), SignatureAlgorithm.HS256)
                .compact();
    }

Here we are adding "role" inside token.

===================================================================================================================

âœ… Step 2: Update AuthServiceImpl (login)

Currently you have:

String token = jwtService.generateToken(loginRequestDto.getEmail());

Replace it with:

UserDetails userDetails = customUserDetailsService.loadUserByUsername(loginRequestDto.getEmail());

String token = jwtService.generateToken(userDetails);

======================================================================================================================

âœ… Step 3: Update SecurityConfig for Role Based Access

Example:

/api/auth/** â†’ public

/api/admin/** â†’ only ADMIN

/api/users/** â†’ only CUSTOMER + ADMIN

Update SecurityConfig:

.authorizeHttpRequests(auth -> auth
        .requestMatchers("/api/auth/**").permitAll()
        .requestMatchers("/api/admin/**").hasRole("ADMIN")
        .requestMatchers("/api/users/**").hasAnyRole("ADMIN", "CUSTOMER")
        .requestMatchers("/swagger-ui/**", "/v3/api-docs/**", "/swagger-ui.html").permitAll()
        .anyRequest().authenticated()
)

=========================================================================================================================

âœ… Step 4: Create AdminController (Test)

Create:

ğŸ“Œ com.advann.user_service.controller.AdminController

package com.advann.user_service.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/api/admin")
public class AdminController {

    @GetMapping("/test")
    public String adminTest() {
        return "Hello Admin, You are authorized!";
    }
}

=========================================================================================================================

âœ… Step 5: Create UserController (Test)

ğŸ“Œ com.advann.user_service.controller.UserTestController

@GetMapping("/test")
    public String userTest() {
        return "Hello User, You are authorized!";
    }

===================================================================================================

âœ… Step 6: Test in Postman
ğŸ”¹ Call login

POST http://localhost:8083/api/auth/login

Copy token.

ğŸ”¹ Call secured API

GET http://localhost:8083/api/admin/test

Add header:

Authorization: Bearer YOUR_TOKEN
âœ… Output Expected
If role = ADMIN

âœ… /api/admin/test works

If role = CUSTOMER

âŒ /api/admin/test gives 403

But /api/users/test works.