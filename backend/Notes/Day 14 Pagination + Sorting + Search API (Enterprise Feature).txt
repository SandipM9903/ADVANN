ðŸ”¥ Now weâ€™ll make your Product API enterprise level.

We will implement:

âœ… Pagination
âœ… Sorting (asc/desc)
âœ… Search by keyword (name)
âœ… Filter by categoryId

==========================================================================================

âœ… STEP 1: Update ProductRepository

ðŸ“Œ ProductRepository.java

package com.advann.product_service.repository;


import com.advann.product_service.entity.Product;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;


public interface ProductRepository extends JpaRepository<Product, Long> {


    // Search by product name
    Page<Product> findByNameContainingIgnoreCase(String keyword, Pageable pageable);


    // Filter by category
    Page<Product> findByCategoryId(Long categoryId, Pageable pageable);


    // Search + category filter combined
    Page<Product> findByCategoryIdAndNameContainingIgnoreCase(Long categoryId, String keyword, Pageable pageable);
}

=============================================================================================

âœ… STEP 2: Create PaginationResponse DTO

ðŸ“Œ dto/PagedResponseDto.java

package com.advann.product_service.dto;


import lombok.Builder;
import lombok.Data;


import java.util.List;


@Data
@Builder
public class PagedResponseDto<T> {


    private List<T> content;
    private int pageNumber;
    private int pageSize;
    private long totalElements;
    private int totalPages;
    private boolean last;
}

================================================================================================

âœ… STEP 3: Update ProductService Interface

ðŸ“Œ ProductService.java

PagedResponseDto<ProductResponseDto> getAllProducts(
        int page,
        int size,
        String sortBy,
        String sortDir,
        String keyword,
        Long categoryId
);

=======================================================================================

âœ… STEP 4: Implement in ProductServiceImpl

ðŸ“Œ ProductServiceImpl.java

@Override
public PagedResponseDto<ProductResponseDto> getAllProducts(
        int page,
        int size,
        String sortBy,
        String sortDir,
        String keyword,
        Long categoryId
) {


    Sort sort = sortDir.equalsIgnoreCase("desc")
            ? Sort.by(sortBy).descending()
            : Sort.by(sortBy).ascending();


    Pageable pageable = PageRequest.of(page, size, sort);


    Page<Product> productPage;


    // âœ… category + keyword
    if (categoryId != null && keyword != null && !keyword.isBlank()) {
        productPage = productRepository.findByCategoryIdAndNameContainingIgnoreCase(categoryId, keyword, pageable);
    }
    // âœ… only category filter
    else if (categoryId != null) {
        productPage = productRepository.findByCategoryId(categoryId, pageable);
    }
    // âœ… only keyword search
    else if (keyword != null && !keyword.isBlank()) {
        productPage = productRepository.findByNameContainingIgnoreCase(keyword, pageable);
    }
    // âœ… normal pagination
    else {
        productPage = productRepository.findAll(pageable);
    }


    List<ProductResponseDto> products = productPage.getContent()
            .stream()
            .map(product -> ProductResponseDto.builder()
                    .id(product.getId())
                    .name(product.getName())
                    .price(product.getPrice())
                    .quantity(product.getQuantity())
                    .categoryId(product.getCategory().getId())
                    .categoryName(product.getCategory().getName())
                    .build()
            )
            .toList();


    return PagedResponseDto.<ProductResponseDto>builder()
            .content(products)
            .pageNumber(productPage.getNumber())
            .pageSize(productPage.getSize())
            .totalElements(productPage.getTotalElements())
            .totalPages(productPage.getTotalPages())
            .last(productPage.isLast())
            .build();
}

==============================================================================================================

âœ… STEP 5: Update ProductController

ðŸ“Œ ProductController.java

Replace your getAllProducts API with this:

@GetMapping
public ResponseEntity<ApiResponse<PagedResponseDto<ProductResponseDto>>> getAllProducts(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "5") int size,
        @RequestParam(defaultValue = "id") String sortBy,
        @RequestParam(defaultValue = "asc") String sortDir,
        @RequestParam(required = false) String keyword,
        @RequestParam(required = false) Long categoryId
) {


    PagedResponseDto<ProductResponseDto> responseDto =
            productService.getAllProducts(page, size, sortBy, sortDir, keyword, categoryId);


    return ResponseEntity.ok(
            ApiResponse.<PagedResponseDto<ProductResponseDto>>builder()
                    .success(true)
                    .message("Products fetched successfully")
                    .data(responseDto)
                    .build()
    );
}

==================================================================================================================

âœ… STEP 6: Test APIs in Postman
âœ… Normal Pagination

GET /api/products?page=0&size=2

âœ… Sorting by Price Desc

GET /api/products?page=0&size=5&sortBy=price&sortDir=desc

âœ… Search Product

GET /api/products?keyword=iphone

âœ… Filter by Category

GET /api/products?categoryId=2

âœ… Category + Search Together

GET /api/products?categoryId=2&keyword=iphone